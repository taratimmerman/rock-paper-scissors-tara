const t="player",e="computer",o=[0,50,100,null],a={matchRoundNumber:1,playerHealth:100,computerHealth:100},s={player:"playerHealth",computer:"computerHealth"},r={ROCK:"rock",PAPER:"paper",SCISSORS:"scissors",TARA:"tara"},i=[{name:r.ROCK,beats:[r.SCISSORS]},{name:r.PAPER,beats:[r.ROCK]},{name:r.SCISSORS,beats:[r.PAPER]},{name:r.TARA,beats:[r.ROCK,r.PAPER,r.SCISSORS]}],l=i.map(t=>t.name),h=new Map(i.map(t=>[t.name,t])),n=i.filter(t=>t.name!==r.TARA),m=n.map(t=>t.name);n.map(t=>[t.name,t]);const u="Score",g="TaraCount",c="MostCommonMove",M="MoveCounts",d="roundNumber",v="globalMatchNumber",C="currentMatch",S={[r.ROCK]:0,[r.PAPER]:0,[r.SCISSORS]:0};class p{formatKey(t,e){return`${t}${e}`}safelySetItem(t,e){try{localStorage.setItem(t,e)}catch(e){console.warn(`LocalStorage Error: Failed to save "${t}".`,e)}}getScore(t){let e=this.formatKey(t,u);return parseInt(localStorage.getItem(e)||"0",10)}getTaraCount(t){let e=this.formatKey(t,g);return parseInt(localStorage.getItem(e)||"0",10)}getMostCommonMove(t){let e=this.formatKey(t,c),o=localStorage.getItem(e);return o&&m.includes(o)?o:null}getMoveCounts(t){let e=this.formatKey(t,M);try{let t=localStorage.getItem(e);return t?JSON.parse(t):S}catch(t){return console.warn(`LocalStorage Error: Failed to parse "${e}".`,t),S}}getGlobalMatchNumber(){let t=localStorage.getItem(v);return null!==t?parseInt(t,10):null}getMatch(){try{let t=localStorage.getItem(C);return t?JSON.parse(t):null}catch(t){return console.warn("LocalStorage Error: Failed to parse currentMatch.",t),null}}getOldGlobalRoundNumber(){let t=localStorage.getItem(d);if(null===t)return null;let e=parseInt(t,10);return isNaN(e)?(console.warn(`Legacy 'roundNumber' in localStorage (${t}) is not a valid number. Skipping migration.`),null):e}setScore(t,e){let o=this.formatKey(t,u);this.safelySetItem(o,e.toString())}setTaraCount(t,e){let o=this.formatKey(t,g);this.safelySetItem(o,e.toString())}setMostCommonMove(t,e){let o=this.formatKey(t,c);e?this.safelySetItem(o,e):localStorage.removeItem(o)}setMoveCounts(t,e){let o=this.formatKey(t,M);this.safelySetItem(o,JSON.stringify(e))}setGlobalMatchNumber(t){t?this.safelySetItem(v,t.toString()):localStorage.removeItem(v)}setMatch(t){t?this.safelySetItem(C,JSON.stringify(t)):localStorage.removeItem(C)}removeScore(t){let e=this.formatKey(t,u);localStorage.removeItem(e)}removeTaraCount(t){let e=this.formatKey(t,g);localStorage.removeItem(e)}removeMostCommonMove(t){let e=this.formatKey(t,c);localStorage.removeItem(e)}removeMoveCounts(t){let e=this.formatKey(t,M);localStorage.removeItem(e)}removeHistory(t){let e=this.formatKey(t,"History");localStorage.removeItem(e)}removeGlobalMatchNumber(){localStorage.removeItem(v)}removeOldGlobalRoundNumber(){localStorage.removeItem(d)}}class y{state={scores:{player:0,computer:0},moves:{player:null,computer:null},taras:{player:0,computer:0},mostCommonMove:{player:null,computer:null},moveCounts:{player:{rock:0,paper:0,scissors:0},computer:{rock:0,paper:0,scissors:0}},globalMatchNumber:null,currentMatch:null};gameStorage;constructor(o=new p){this.gameStorage=o,this.state.scores.player=this.gameStorage.getScore(t),this.state.scores.computer=this.gameStorage.getScore(e),this.state.taras.player=this.gameStorage.getTaraCount(t),this.state.taras.computer=this.gameStorage.getTaraCount(e),this.state.mostCommonMove.player=this.gameStorage.getMostCommonMove(t),this.state.mostCommonMove.computer=this.gameStorage.getMostCommonMove(e),this.state.moveCounts.player=this.gameStorage.getMoveCounts(t),this.state.moveCounts.computer=this.gameStorage.getMoveCounts(e),this._loadOrMigrateMatchState()}doesMoveBeat(t,e){return h.get(t)?.beats.includes(e)??!1}handleRoundWin(t,e){if(this.isStandardMove(e)){let e=this.getTaraCount(t);e<3&&this.setTaraCount(t,e+1)}}evaluateRound(){let o=this.getPlayerMove(),a=this.getComputerMove();return null===o||null===a?"Invalid round":(this.handleTaraMove(t,o),this.handleTaraMove(e,a),o===a)?"It's a tie!":this.doesMoveBeat(o,a)?(this.handleRoundWin(t,o),this.decrementHealth(e),"You win the round!"):(this.handleRoundWin(e,a),this.decrementHealth(t),"Computer wins the round!")}isMatchActive(){return null!==this.gameStorage.getMatch()}setScore(t,e){this.state.scores[t]=e,this.gameStorage.setScore(t,e)}getScore(t){return this.state.scores[t]}resetScore(t){this.state.scores[t]=0,this.gameStorage.removeScore(t)}setPlayerScore(e){this.setScore(t,e)}setComputerScore(t){this.setScore(e,t)}getPlayerScore(){return this.getScore(t)}getComputerScore(){return this.getScore(e)}resetScores(){this.resetScore(t),this.resetScore(e)}isStandardMove(t){return"string"==typeof t&&t!==r.TARA}setMove(t,e){this.state.moves[t]=e}getMove(t){return this.state.moves[t]}determineMostCommonMove(t){let e=null,o=0,a=!1;for(let[s,r]of Object.entries(t))r>o?(o=r,e=s,a=!1):r===o&&0!==r&&(a=!0);return a?null:e}resetMostCommonMove(t){this.state.mostCommonMove[t]=null,this.gameStorage.removeMostCommonMove(t)}setMostCommonMove(t,e){let o=this.determineMostCommonMove(e);this.state.mostCommonMove[t]=o,this.gameStorage.setMostCommonMove(t,o)}getMostCommonMove(t){return this.state.mostCommonMove[t]}getAvailableMoves(t){return t?l:m}getBaseWeights(){return{[r.ROCK]:1,[r.PAPER]:1,[r.SCISSORS]:1,[r.TARA]:0}}getTaraWeight(t){if(!t.includes(r.TARA))return null;let{player:e,computer:o}=this.state.scores,a=e-o;return a>0?Math.min(3+a,10):a<0?1:2}getStandardMoveWeights(){let t={[r.ROCK]:1,[r.PAPER]:1,[r.SCISSORS]:1},e=this.state.mostCommonMove.player;if(!e)return t;let o={[r.ROCK]:r.PAPER,[r.PAPER]:r.SCISSORS,[r.SCISSORS]:r.ROCK}[e];return{[r.ROCK]:o===r.ROCK?5:2,[r.PAPER]:o===r.PAPER?5:2,[r.SCISSORS]:o===r.SCISSORS?5:2}}chooseWeightedRandomMove(t,e){let o=t.flatMap(t=>Array(e[t]).fill(t)),a=Math.floor(Math.random()*o.length);return o[a]}getComputerMoveWeights(t){let e=this.getBaseWeights(),o=this.getTaraWeight(t),a=this.getStandardMoveWeights();return{...e,...a,...null!==o?{[r.TARA]:o}:{}}}getWeightedComputerMove(){let t=this.getComputerTaraCount()>0,e=this.getAvailableMoves(t),o=this.getComputerMoveWeights(e);return this.chooseWeightedRandomMove(e,o)}setPlayerMove(e){this.setMove(t,e)}getPlayerMove(){return this.getMove(t)}setComputerMove(t){this.setMove(e,t)}getComputerMove(){return this.getMove(e)}resetMoves(){this.setPlayerMove(null),this.setComputerMove(null)}chooseComputerMove(){let t=this.getWeightedComputerMove();this.registerComputerMove(t)}registerPlayerMove(e){this.setPlayerMove(e),this.isStandardMove(e)&&(this.setMoveCounts(t,e),this.setPlayerMostCommonMove())}registerComputerMove(t){this.setComputerMove(t),this.isStandardMove(t)&&(this.setMoveCounts(e,t),this.setComputerMostCommonMove())}setPlayerMostCommonMove(){let e=this.getMoveCounts(t);this.setMostCommonMove(t,e)}setComputerMostCommonMove(){let t=this.getMoveCounts(e);this.setMostCommonMove(e,t)}resetMostCommonMoves(){this.resetMostCommonMove(t),this.resetMostCommonMove(e)}getPlayerMostCommonMove(){return this.getMostCommonMove(t)}getComputerMostCommonMove(){return this.getMostCommonMove(e)}setMoveCounts(t,e){this.state.moveCounts[t][e]=(this.state.moveCounts[t][e]||0)+1,this.gameStorage.setMoveCounts(t,this.state.moveCounts[t])}resetMoveCounts(t){this.state.moveCounts[t]={rock:0,paper:0,scissors:0},this.gameStorage.removeMoveCounts(t)}getMoveCounts(t){return this.state.moveCounts[t]}resetBothMoveCounts(){this.resetMoveCounts(t),this.resetMoveCounts(e)}showMostCommonMove(){return null!==this.getPlayerMostCommonMove()||null!==this.getComputerMostCommonMove()}resetHistory(t){this.gameStorage.removeHistory(t)}resetHistories(){this.resetHistory(t),this.resetHistory(e)}getRoundNumber(){return this.state.currentMatch?.matchRoundNumber??1}setRoundNumber(t){this.state.currentMatch&&(this.state.currentMatch.matchRoundNumber=t,this.gameStorage.setMatch(this.state.currentMatch))}increaseRoundNumber(){let t=this.getRoundNumber();this.setRoundNumber(t+1)}decrementTaraCount(t){let e=this.getTaraCount(t);e>1?this.setTaraCount(t,e-1):1===e&&this.resetTaraCount(t)}handleTaraMove(t,e){e===r.TARA&&(this.getTaraCount(t)>0?this.decrementTaraCount(t):this.setMove(t,r.ROCK))}setTaraCount(t,e){this.state.taras[t]=e,this.gameStorage.setTaraCount(t,e)}getTaraCount(t){return this.state.taras[t]}resetTaraCount(t){this.state.taras[t]=0,this.gameStorage.removeTaraCount(t)}setPlayerTaraCount(e){this.setTaraCount(t,e)}setComputerTaraCount(t){this.setTaraCount(e,t)}resetTaras(){this.resetTaraCount(t),this.resetTaraCount(e)}getPlayerTaraCount(){return this.getTaraCount(t)}getComputerTaraCount(){return this.getTaraCount(e)}taraIsEnabled(){return this.getTaraCount(t)>0}handleMatchWin(){let t=this.getMatchWinner();return this.setScore(t,this.getScore(t)+1),t}setMatch(t){this.state.currentMatch=t,this.gameStorage.setMatch(t)}setMatchNumber(t){this.state.globalMatchNumber=t,this.gameStorage.setGlobalMatchNumber(t)}setDefaultMatchData(){this.isMatchActive()||this.setMatch({...a})}resetMatchData(){this.state.currentMatch=null,this.gameStorage.setMatch(null),this.setMatchNumber(null)}getMatchNumber(){return this.state.globalMatchNumber??1}isMatchOver(){return this.isDefeated(t)||this.isDefeated(e)}getMatchWinner(){return this.isDefeated(t)?e:t}incrementMatchNumber(){let t=this.getMatchNumber();this.setMatchNumber(t+1)}_loadOrMigrateMatchState(){if(this.isMatchActive())return void this._loadExistingMatchState();let t=this.gameStorage.getOldGlobalRoundNumber();null!==t&&t>0&&this._migrateOldData(t)}_loadExistingMatchState(){this.state.globalMatchNumber=this.gameStorage.getGlobalMatchNumber(),this.state.currentMatch=this.gameStorage.getMatch()}_migrateOldData(t){this.setMatch({matchRoundNumber:t,playerHealth:100,computerHealth:100,initialHealth:100,damagePerLoss:50}),this.gameStorage.removeOldGlobalRoundNumber(),this.state.globalMatchNumber=1,this.gameStorage.setGlobalMatchNumber(this.state.globalMatchNumber)}getHealthKey(t){return s[t]}getHealth(t){let e=this.state.currentMatch;if(!e)return null;let a=e[this.getHealthKey(t)];return o.includes(a)?a:null}decrementHealth(t){let e=this.state.currentMatch;if(!e)return!1;let o=this.getHealthKey(t),a=e[o];return!(a<=0)&&(e[o]=Math.max(0,a-50),!0)}isDefeated(t){let e=this.getHealth(t);return null!==e&&e<=0}}class E{messageEl=this.getEl("message");overlay=this.getEl("overlay");controls=this.getEl("initial-controls");playerScoreEl=this.getEl("player-score");computerScoreEl=this.getEl("computer-score");playerHealthEl=this.getEl("player-health-text");computerHealthEl=this.getEl("computer-health-text");playerHealthBarEl=this.getEl("player-health");computerHealthBarEl=this.getEl("computer-health");playerTaraCountEl=this.getEl("player-tara");computerTaraCountEl=this.getEl("computer-tara");playerMostCommonMoveEl=this.getEl("player-most-common-move");computerMostCommonMoveEl=this.getEl("computer-most-common-move");matchEl=this.getEl("match");roundEl=this.getEl("round");outcomeEl=this.getEl("result-display");movesEl=this.getEl("round-moves");resultEl=this.getEl("round-result");moveChoicesEl=this.getEl("choices");taraBtn=this.getEl("tara");startBtn=this.getEl("start");playAgainBtn=this.getEl("play-again");gameStatsEl=this.getEl("game-stats");resetBtn=this.getEl("reset-game-state");getEl(t){let e=document.getElementById(t);if(!e)throw Error(`Critical element not found: #${t}`);return e}toggle(t,e){t.classList.toggle("hidden",!e)}bindStartGame(t){this.startBtn?.addEventListener("click",t)}bindPlayAgain(t){this.playAgainBtn?.addEventListener("click",t)}bindResetGame(t){this.resetBtn?.addEventListener("click",t)}bindPlayerMove(t){Object.values(r).forEach(e=>{this.getEl(e)?.addEventListener("click",()=>t(e))})}updateMessage(t){this.messageEl&&(this.messageEl.textContent=t)}toggleOverlay(t){this.toggle(this.overlay,t)}toggleControls(t){this.toggle(this.controls,t)}toggleMoveButtons(t){this.toggle(this.moveChoicesEl,t)}togglePlayAgain(t){this.toggle(this.playAgainBtn,t)}toggleGameStats(t){this.toggle(this.gameStatsEl,t)}updateRound(t){this.roundEl.textContent=`Round ${t}`,this.toggle(this.roundEl,!0)}updateMatch(t){this.matchEl.textContent=`Match ${t}`,this.toggle(this.matchEl,!0)}resetForNextRound(){this.toggleGameStats(!0),this.toggleMoveButtons(!0),this.togglePlayAgain(!1),this.toggle(this.outcomeEl,!1)}updateStartButton(t){this.startBtn.textContent=t?"Resume Match":"Start Match"}updatePlayAgainButton(t){this.playAgainBtn.textContent=t?"Start New Match":"Next Round"}activateSpinner(t){this.toggleOverlay(t)}showOutcomeText(t,e,o){this.movesEl.textContent=`You played ${t}. Computer played ${e}.`,this.resultEl.textContent=o,this.toggle(this.outcomeEl,!0)}showRoundOutcome(t,e,o){this.showOutcomeText(t,e,o.toUpperCase())}showMatchOutcome(t,e,o){this.showOutcomeText(t,e,`${o.toUpperCase()} WON THE MATCH!`)}updateScores(t,e){this.playerScoreEl.textContent=t.toString(),this.computerScoreEl.textContent=e.toString()}updateTaraCounts(t,e){this.playerTaraCountEl.textContent=t.toString(),this.computerTaraCountEl.textContent=e.toString()}updateTaraButton(t,e){this.taraBtn.disabled=!t,this.taraBtn.textContent=`Tara (x${e})`}updateMostCommonMoves(t,e){this.playerMostCommonMoveEl.textContent=t??"N/A",this.computerMostCommonMoveEl.textContent=e??"N/A"}updateHealth(t,e){this.playerHealthEl.textContent=(t??0).toString(),this.computerHealthEl.textContent=(e??0).toString()}getHealthBar(t){return"player"===t?this.playerHealthBarEl:this.computerHealthBarEl}updateHealthBar(t,e){let o=this.getHealthBar(t);switch(o.className="bar",e){case 100:o.classList.add("full");break;case 50:o.classList.add("half");break;case 0:case null:o.classList.add("zero")}}}class w{model;view;constructor(t,e){this.model=t,this.view=e}updateScoreView(){this.view.updateScores(this.model.getPlayerScore(),this.model.getComputerScore())}updateTaraView(){this.view.updateTaraCounts(this.model.getPlayerTaraCount(),this.model.getComputerTaraCount())}updateMostCommonMoveView(){this.view.updateMostCommonMoves(this.model.getPlayerMostCommonMove(),this.model.getComputerMostCommonMove())}updateHealthView(){let o=this.model.getHealth(t),a=this.model.getHealth(e);this.view.updateHealth(o,a),this.view.updateHealthBar(t,o),this.view.updateHealthBar(e,a)}updateTaraButtonView(){let t=this.model.taraIsEnabled(),e=this.model.getPlayerTaraCount();this.view.updateTaraButton(t,e)}startGame(){let t=this.model.getRoundNumber(),e=this.model.getMatchNumber();this.model.setDefaultMatchData(),this.view.updateRound(t),this.view.updateMatch(e),this.view.toggleControls(!1),this.view.toggleGameStats(!0),this.view.toggleMoveButtons(!0),this.updateHealthView()}endRound(){let t=this.model.getPlayerMove(),e=this.model.getComputerMove(),o=this.model.evaluateRound(),a=this.model.isMatchOver();if(this.updateHealthView(),a){let o=this.model.handleMatchWin();this.view.showMatchOutcome(t,e,o),this.model.incrementMatchNumber(),this.model.setMatch(null)}else this.view.showRoundOutcome(t,e,o),this.model.increaseRoundNumber();this.updateScoreView(),this.updateTaraView(),this.updateMostCommonMoveView(),this.updateTaraButtonView(),this.view.updatePlayAgainButton(a),this.view.togglePlayAgain(!0)}handleNextRound(){this.model.setDefaultMatchData();let t=this.model.getRoundNumber(),e=this.model.getMatchNumber();this.updateHealthView(),this.view.updateRound(t),this.view.updateMatch(e),this.view.resetForNextRound()}waitForTimeout(t){return new Promise(e=>setTimeout(e,t))}async resetGameState(){this.view.activateSpinner(!0),this.model.resetScores(),this.model.resetMoves(),this.model.resetTaras(),this.model.resetHistories(),this.model.resetBothMoveCounts(),this.model.resetMostCommonMoves(),this.model.resetMatchData(),this.updateScoreView(),this.updateTaraView(),this.updateHealthView(),this.updateMostCommonMoveView(),this.updateTaraButtonView();let t=this.model.isMatchActive();this.view.updateStartButton(t),await this.waitForTimeout(250),this.view.activateSpinner(!1)}async handlePlayerMove(t){this.view.activateSpinner(!0),this.view.toggleMoveButtons(!1),this.model.resetMoves(),this.model.registerPlayerMove(t),this.model.chooseComputerMove(),await this.waitForTimeout(500),this.view.activateSpinner(!1),await this.waitForTimeout(250),this.endRound()}async initialize(){let t=this.model.isMatchActive();this.updateScoreView(),this.updateTaraView(),this.updateMostCommonMoveView(),this.updateTaraButtonView(),await this.waitForTimeout(500),this.view.updateMessage("Rock, Paper, Scissors, Tara"),this.view.activateSpinner(!1),this.view.updateStartButton(t),this.view.toggleGameStats(!1),this.view.toggleMoveButtons(!1),this.view.togglePlayAgain(!1),this.view.toggleControls(!0),this.view.bindStartGame(()=>this.startGame()),this.view.bindPlayAgain(()=>this.handleNextRound()),this.view.bindResetGame(()=>this.resetGameState()),this.view.bindPlayerMove(t=>this.handlePlayerMove(t))}}document.addEventListener("DOMContentLoaded",()=>{new w(new y,new E).initialize()});
//# sourceMappingURL=public.138719d9.js.map
