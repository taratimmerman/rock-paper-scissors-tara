const t={ROCK:{id:"rock",beats:["scissors"],isStandard:!0,text:"Rock",icon:"\uD83E\uDEA8"},PAPER:{id:"paper",beats:["rock"],isStandard:!0,text:"Paper",icon:"\uD83D\uDCC4"},SCISSORS:{id:"scissors",beats:["paper"],isStandard:!0,text:"Scissors",icon:"✂️"},TARA:{id:"tara",beats:["rock","paper","scissors"],isStandard:!1,text:"Tara",icon:"⭐"}},e=Object.values(t),o=Object.fromEntries(Object.entries(t).map(([t,e])=>[t,e.id])),s=e.map(t=>({name:t.id,beats:t.beats})),a=e.map(t=>t.id),r=new Map(s.map(t=>[t.name,t])),i=s.filter((t,o)=>e[o].isStandard),l=i.map(t=>t.name);i.map(t=>[t.name,t]);const h=e.map(t=>({id:t.id,text:t.text,icon:t.icon})),n="player",m="computer",u=[0,50,100,null],g={matchRoundNumber:1,playerHealth:100,computerHealth:100},c={player:"playerHealth",computer:"computerHealth"},d="Score",M="TaraCount",v="MostCommonMove",C="MoveCounts",p="roundNumber",S="globalMatchNumber",y="currentMatch",E={[o.ROCK]:0,[o.PAPER]:0,[o.SCISSORS]:0};class b{formatKey(t,e){return`${t}${e}`}safelySetItem(t,e){try{localStorage.setItem(t,e)}catch(e){console.warn(`LocalStorage Error: Failed to save "${t}".`,e)}}getScore(t){let e=this.formatKey(t,d);return parseInt(localStorage.getItem(e)||"0",10)}getTaraCount(t){let e=this.formatKey(t,M);return parseInt(localStorage.getItem(e)||"0",10)}getMostCommonMove(t){let e=this.formatKey(t,v),o=localStorage.getItem(e);return o&&l.includes(o)?o:null}getMoveCounts(t){let e=this.formatKey(t,C);try{let t=localStorage.getItem(e);return t?JSON.parse(t):E}catch(t){return console.warn(`LocalStorage Error: Failed to parse "${e}".`,t),E}}getGlobalMatchNumber(){let t=localStorage.getItem(S);return null!==t?parseInt(t,10):null}getMatch(){try{let t=localStorage.getItem(y);return t?JSON.parse(t):null}catch(t){return console.warn("LocalStorage Error: Failed to parse currentMatch.",t),null}}getOldGlobalRoundNumber(){let t=localStorage.getItem(p);if(null===t)return null;let e=parseInt(t,10);return isNaN(e)?(console.warn(`Legacy 'roundNumber' in localStorage (${t}) is not a valid number. Skipping migration.`),null):e}setScore(t,e){let o=this.formatKey(t,d);this.safelySetItem(o,e.toString())}setTaraCount(t,e){let o=this.formatKey(t,M);this.safelySetItem(o,e.toString())}setMostCommonMove(t,e){let o=this.formatKey(t,v);e?this.safelySetItem(o,e):localStorage.removeItem(o)}setMoveCounts(t,e){let o=this.formatKey(t,C);this.safelySetItem(o,JSON.stringify(e))}setGlobalMatchNumber(t){t?this.safelySetItem(S,t.toString()):localStorage.removeItem(S)}setMatch(t){t?this.safelySetItem(y,JSON.stringify(t)):localStorage.removeItem(y)}removeScore(t){let e=this.formatKey(t,d);localStorage.removeItem(e)}removeTaraCount(t){let e=this.formatKey(t,M);localStorage.removeItem(e)}removeMostCommonMove(t){let e=this.formatKey(t,v);localStorage.removeItem(e)}removeMoveCounts(t){let e=this.formatKey(t,C);localStorage.removeItem(e)}removeHistory(t){let e=this.formatKey(t,"History");localStorage.removeItem(e)}removeGlobalMatchNumber(){localStorage.removeItem(S)}removeOldGlobalRoundNumber(){localStorage.removeItem(p)}}class w{state={scores:{player:0,computer:0},moves:{player:null,computer:null},taras:{player:0,computer:0},mostCommonMove:{player:null,computer:null},moveCounts:{player:{rock:0,paper:0,scissors:0},computer:{rock:0,paper:0,scissors:0}},globalMatchNumber:null,currentMatch:null};gameStorage;constructor(t=new b){this.gameStorage=t,this.state.scores.player=this.gameStorage.getScore(n),this.state.scores.computer=this.gameStorage.getScore(m),this.state.taras.player=this.gameStorage.getTaraCount(n),this.state.taras.computer=this.gameStorage.getTaraCount(m),this.state.mostCommonMove.player=this.gameStorage.getMostCommonMove(n),this.state.mostCommonMove.computer=this.gameStorage.getMostCommonMove(m),this.state.moveCounts.player=this.gameStorage.getMoveCounts(n),this.state.moveCounts.computer=this.gameStorage.getMoveCounts(m),this._loadOrMigrateMatchState()}doesMoveBeat(t,e){return r.get(t)?.beats.includes(e)??!1}handleRoundWin(t,e){if(this.isStandardMove(e)){let e=this.getTaraCount(t);e<3&&this.setTaraCount(t,e+1)}}evaluateRound(){let t=this.getPlayerMove(),e=this.getComputerMove();return null===t||null===e?"Invalid round":(this.handleTaraMove(n,t),this.handleTaraMove(m,e),t===e)?"It's a tie!":this.doesMoveBeat(t,e)?(this.handleRoundWin(n,t),this.decrementHealth(m),"You win the round!"):(this.handleRoundWin(m,e),this.decrementHealth(n),"Computer wins the round!")}isMatchActive(){return null!==this.gameStorage.getMatch()}setScore(t,e){this.state.scores[t]=e,this.gameStorage.setScore(t,e)}getScore(t){return this.state.scores[t]}resetScore(t){this.state.scores[t]=0,this.gameStorage.removeScore(t)}setPlayerScore(t){this.setScore(n,t)}setComputerScore(t){this.setScore(m,t)}getPlayerScore(){return this.getScore(n)}getComputerScore(){return this.getScore(m)}resetScores(){this.resetScore(n),this.resetScore(m)}isStandardMove(t){return"string"==typeof t&&t!==o.TARA}setMove(t,e){this.state.moves[t]=e}getMove(t){return this.state.moves[t]}determineMostCommonMove(t){let e=null,o=0,s=!1;for(let[a,r]of Object.entries(t))r>o?(o=r,e=a,s=!1):r===o&&0!==r&&(s=!0);return s?null:e}resetMostCommonMove(t){this.state.mostCommonMove[t]=null,this.gameStorage.removeMostCommonMove(t)}setMostCommonMove(t,e){let o=this.determineMostCommonMove(e);this.state.mostCommonMove[t]=o,this.gameStorage.setMostCommonMove(t,o)}getMostCommonMove(t){return this.state.mostCommonMove[t]}getAvailableMoves(t){return t?a:l}getBaseWeights(){return{[o.ROCK]:1,[o.PAPER]:1,[o.SCISSORS]:1,[o.TARA]:0}}getTaraWeight(t){if(!t.includes(o.TARA))return null;let{player:e,computer:s}=this.state.scores,a=e-s;return a>0?Math.min(3+a,10):a<0?1:2}getStandardMoveWeights(){let t={[o.ROCK]:1,[o.PAPER]:1,[o.SCISSORS]:1},e=this.state.mostCommonMove.player;if(!e)return t;let s={[o.ROCK]:o.PAPER,[o.PAPER]:o.SCISSORS,[o.SCISSORS]:o.ROCK}[e];return{[o.ROCK]:s===o.ROCK?5:2,[o.PAPER]:s===o.PAPER?5:2,[o.SCISSORS]:s===o.SCISSORS?5:2}}chooseWeightedRandomMove(t,e){let o=t.flatMap(t=>Array(e[t]).fill(t)),s=Math.floor(Math.random()*o.length);return o[s]}getComputerMoveWeights(t){let e=this.getBaseWeights(),s=this.getTaraWeight(t),a=this.getStandardMoveWeights();return{...e,...a,...null!==s?{[o.TARA]:s}:{}}}getWeightedComputerMove(){let t=this.getComputerTaraCount()>0,e=this.getAvailableMoves(t),o=this.getComputerMoveWeights(e);return this.chooseWeightedRandomMove(e,o)}setPlayerMove(t){this.setMove(n,t)}getPlayerMove(){return this.getMove(n)}setComputerMove(t){this.setMove(m,t)}getComputerMove(){return this.getMove(m)}resetMoves(){this.setPlayerMove(null),this.setComputerMove(null)}chooseComputerMove(){let t=this.getWeightedComputerMove();this.registerComputerMove(t)}registerPlayerMove(t){this.setPlayerMove(t),this.isStandardMove(t)&&(this.setMoveCounts(n,t),this.setPlayerMostCommonMove())}registerComputerMove(t){this.setComputerMove(t),this.isStandardMove(t)&&(this.setMoveCounts(m,t),this.setComputerMostCommonMove())}setPlayerMostCommonMove(){let t=this.getMoveCounts(n);this.setMostCommonMove(n,t)}setComputerMostCommonMove(){let t=this.getMoveCounts(m);this.setMostCommonMove(m,t)}resetMostCommonMoves(){this.resetMostCommonMove(n),this.resetMostCommonMove(m)}getPlayerMostCommonMove(){return this.getMostCommonMove(n)}getComputerMostCommonMove(){return this.getMostCommonMove(m)}setMoveCounts(t,e){this.state.moveCounts[t][e]=(this.state.moveCounts[t][e]||0)+1,this.gameStorage.setMoveCounts(t,this.state.moveCounts[t])}resetMoveCounts(t){this.state.moveCounts[t]={rock:0,paper:0,scissors:0},this.gameStorage.removeMoveCounts(t)}getMoveCounts(t){return this.state.moveCounts[t]}resetBothMoveCounts(){this.resetMoveCounts(n),this.resetMoveCounts(m)}showMostCommonMove(){return null!==this.getPlayerMostCommonMove()||null!==this.getComputerMostCommonMove()}resetHistory(t){this.gameStorage.removeHistory(t)}resetHistories(){this.resetHistory(n),this.resetHistory(m)}getRoundNumber(){return this.state.currentMatch?.matchRoundNumber??1}setRoundNumber(t){this.state.currentMatch&&(this.state.currentMatch.matchRoundNumber=t,this.gameStorage.setMatch(this.state.currentMatch))}increaseRoundNumber(){let t=this.getRoundNumber();this.setRoundNumber(t+1)}decrementTaraCount(t){let e=this.getTaraCount(t);e>1?this.setTaraCount(t,e-1):1===e&&this.resetTaraCount(t)}handleTaraMove(t,e){e===o.TARA&&(this.getTaraCount(t)>0?this.decrementTaraCount(t):this.setMove(t,o.ROCK))}setTaraCount(t,e){this.state.taras[t]=e,this.gameStorage.setTaraCount(t,e)}getTaraCount(t){return this.state.taras[t]}resetTaraCount(t){this.state.taras[t]=0,this.gameStorage.removeTaraCount(t)}setPlayerTaraCount(t){this.setTaraCount(n,t)}setComputerTaraCount(t){this.setTaraCount(m,t)}resetTaras(){this.resetTaraCount(n),this.resetTaraCount(m)}getPlayerTaraCount(){return this.getTaraCount(n)}getComputerTaraCount(){return this.getTaraCount(m)}taraIsEnabled(){return this.getTaraCount(n)>0}handleMatchWin(){let t=this.getMatchWinner();return this.setScore(t,this.getScore(t)+1),t}setMatch(t){this.state.currentMatch=t,this.gameStorage.setMatch(t)}setMatchNumber(t){this.state.globalMatchNumber=t,this.gameStorage.setGlobalMatchNumber(t)}setDefaultMatchData(){this.isMatchActive()||this.setMatch({...g})}resetMatchData(){this.state.currentMatch=null,this.gameStorage.setMatch(null),this.setMatchNumber(null)}getMatchNumber(){return this.state.globalMatchNumber??1}isMatchOver(){return this.isDefeated(n)||this.isDefeated(m)}getMatchWinner(){return this.isDefeated(n)?m:n}incrementMatchNumber(){let t=this.getMatchNumber();this.setMatchNumber(t+1)}_loadOrMigrateMatchState(){if(this.isMatchActive())return void this._loadExistingMatchState();let t=this.gameStorage.getOldGlobalRoundNumber();null!==t&&t>0&&this._migrateOldData(t)}_loadExistingMatchState(){this.state.globalMatchNumber=this.gameStorage.getGlobalMatchNumber(),this.state.currentMatch=this.gameStorage.getMatch()}_migrateOldData(t){this.setMatch({matchRoundNumber:t,playerHealth:100,computerHealth:100,initialHealth:100,damagePerLoss:50}),this.gameStorage.removeOldGlobalRoundNumber(),this.state.globalMatchNumber=1,this.gameStorage.setGlobalMatchNumber(this.state.globalMatchNumber)}getHealthKey(t){return c[t]}getHealth(t){let e=this.state.currentMatch;if(!e)return null;let o=e[this.getHealthKey(t)];return u.includes(o)?o:null}decrementHealth(t){let e=this.state.currentMatch;if(!e)return!1;let o=this.getHealthKey(t),s=e[o];return!(s<=0)&&(e[o]=Math.max(0,s-50),!0)}isDefeated(t){let e=this.getHealth(t);return null!==e&&e<=0}}class R{messageEl=this.getEl("message");controls=this.getEl("initial-controls");playerScoreEl=this.getEl("player-score");computerScoreEl=this.getEl("computer-score");playerHealthEl=this.getEl("player-health-text");computerHealthEl=this.getEl("computer-health-text");playerHealthBarEl=this.getEl("player-health");computerHealthBarEl=this.getEl("computer-health");playerTaraCountEl=this.getEl("player-tara");computerTaraCountEl=this.getEl("computer-tara");playerMostCommonMoveEl=this.getEl("player-most-common-move");computerMostCommonMoveEl=this.getEl("computer-most-common-move");matchEl=this.getEl("match");roundEl=this.getEl("round");outcomeEl=this.getEl("result-display");movesEl=this.getEl("round-moves");resultEl=this.getEl("round-result");moveChoicesEl=this.getEl("choices");startBtn=this.getEl("start");playAgainBtn=this.getEl("play-again");gameStatsEl=this.getEl("game-stats");resetBtn=this.getEl("reset-game-state");moveButtons=new Map;getEl(t){let e=document.getElementById(t);if(!e)throw Error(`Critical element not found: #${t}`);return e}toggle(t,e){t.classList.toggle("hidden",!e)}bindStartGame(t){this.startBtn?.addEventListener("click",t)}bindPlayAgain(t){this.playAgainBtn?.addEventListener("click",t)}bindResetGame(t){this.resetBtn?.addEventListener("click",t)}bindPlayerMove(t){this.renderChoices(h,t)}updateMessage(t){this.messageEl&&(this.messageEl.textContent=t)}toggleControls(t){this.toggle(this.controls,t)}toggleMoveButtons(t){this.toggle(this.moveChoicesEl,t)}togglePlayAgain(t){this.toggle(this.playAgainBtn,t)}toggleGameStats(t){this.toggle(this.gameStatsEl,t)}updateRound(t){this.roundEl.textContent=`Round ${t}`,this.toggle(this.roundEl,!0)}updateMatch(t){this.matchEl.textContent=`Match ${t}`,this.toggle(this.matchEl,!0)}resetForNextRound(){this.toggleGameStats(!0),this.toggleMoveButtons(!0),this.togglePlayAgain(!1),this.toggle(this.outcomeEl,!1)}updateStartButton(t){this.startBtn.textContent=t?"Resume Match":"Start Match"}updatePlayAgainButton(t){this.playAgainBtn.textContent=t?"Start New Match":"Next Round"}showOutcomeText(t,e,o){this.movesEl.textContent=`You played ${t}. Computer played ${e}.`,this.resultEl.textContent=o,this.toggle(this.outcomeEl,!0)}showRoundOutcome(t,e,o){this.showOutcomeText(t,e,o.toUpperCase())}showMatchOutcome(t,e,o){this.showOutcomeText(t,e,`${o.toUpperCase()} WON THE MATCH!`)}updateScores(t,e){this.playerScoreEl.textContent=t.toString(),this.computerScoreEl.textContent=e.toString()}updateTaraCounts(t,e){this.playerTaraCountEl.textContent=t.toString(),this.computerTaraCountEl.textContent=e.toString()}updateTaraButton(t){let e=o.TARA,s=this.moveButtons.get(e);s&&(s.disabled=!t)}updateMostCommonMoves(t,e){this.playerMostCommonMoveEl.textContent=t??"N/A",this.computerMostCommonMoveEl.textContent=e??"N/A"}updateHealth(t,e){this.playerHealthEl.textContent=(t??0).toString(),this.computerHealthEl.textContent=(e??0).toString()}getHealthBar(t){return"player"===t?this.playerHealthBarEl:this.computerHealthBarEl}updateHealthBar(t,e){let o=this.getHealthBar(t);switch(o.className="bar",e){case 100:o.classList.add("full");break;case 50:o.classList.add("half");break;case 0:case null:o.classList.add("zero")}}createChoiceCard(t,e){let o=document.createElement("button");return o.id=t.id,o.className="card-container",o.innerHTML=`
      <span class="icon" aria-hidden="true">${t.icon}</span>
      <span class="label">${t.text}</span>
    `,o.addEventListener("click",()=>e(t.id)),o}renderChoices(t,e){this.moveChoicesEl.innerHTML="",this.moveButtons.clear(),t.forEach(t=>{let o=this.createChoiceCard(t,e);this.moveChoicesEl.appendChild(o),this.moveButtons.set(t.id,o)})}}class T{model;view;constructor(t,e){this.model=t,this.view=e}updateScoreView(){this.view.updateScores(this.model.getPlayerScore(),this.model.getComputerScore())}updateTaraView(){this.view.updateTaraCounts(this.model.getPlayerTaraCount(),this.model.getComputerTaraCount())}updateMostCommonMoveView(){this.view.updateMostCommonMoves(this.model.getPlayerMostCommonMove(),this.model.getComputerMostCommonMove())}updateHealthView(){let t=this.model.getHealth(n),e=this.model.getHealth(m);this.view.updateHealth(t,e),this.view.updateHealthBar(n,t),this.view.updateHealthBar(m,e)}updateTaraButtonView(){let t=this.model.taraIsEnabled();this.view.updateTaraButton(t)}startGame(){let t=this.model.getRoundNumber(),e=this.model.getMatchNumber();this.model.setDefaultMatchData(),this.view.updateRound(t),this.view.updateMatch(e),this.view.toggleControls(!1),this.view.toggleGameStats(!0),this.view.toggleMoveButtons(!0),this.updateHealthView()}endRound(){let t=this.model.getPlayerMove(),e=this.model.getComputerMove(),o=this.model.evaluateRound(),s=this.model.isMatchOver();if(this.updateHealthView(),s){let o=this.model.handleMatchWin();this.view.showMatchOutcome(t,e,o),this.model.incrementMatchNumber(),this.model.setMatch(null)}else this.view.showRoundOutcome(t,e,o),this.model.increaseRoundNumber();this.updateScoreView(),this.updateTaraView(),this.updateMostCommonMoveView(),this.updateTaraButtonView(),this.view.updatePlayAgainButton(s),this.view.togglePlayAgain(!0)}handleNextRound(){this.model.setDefaultMatchData();let t=this.model.getRoundNumber(),e=this.model.getMatchNumber();this.updateHealthView(),this.view.updateRound(t),this.view.updateMatch(e),this.view.resetForNextRound()}async resetGameState(){this.model.resetScores(),this.model.resetMoves(),this.model.resetTaras(),this.model.resetHistories(),this.model.resetBothMoveCounts(),this.model.resetMostCommonMoves(),this.model.resetMatchData(),this.updateScoreView(),this.updateTaraView(),this.updateHealthView(),this.updateMostCommonMoveView(),this.updateTaraButtonView();let t=this.model.isMatchActive();this.view.updateStartButton(t)}async handlePlayerMove(t){this.view.toggleMoveButtons(!1),this.model.resetMoves(),this.model.registerPlayerMove(t),this.model.chooseComputerMove(),this.endRound()}async initialize(){let t=this.model.isMatchActive();this.updateScoreView(),this.updateTaraView(),this.updateMostCommonMoveView(),this.view.updateMessage("Rock, Paper, Scissors, Tara"),this.view.updateStartButton(t),this.view.toggleGameStats(!1),this.view.toggleMoveButtons(!1),this.view.togglePlayAgain(!1),this.view.toggleControls(!0),this.view.bindStartGame(()=>this.startGame()),this.view.bindPlayAgain(()=>this.handleNextRound()),this.view.bindResetGame(()=>this.resetGameState()),this.view.bindPlayerMove(t=>this.handlePlayerMove(t)),this.updateTaraButtonView()}}document.addEventListener("DOMContentLoaded",()=>{new T(new w,new R).initialize()});
//# sourceMappingURL=public.ac761ce2.js.map
