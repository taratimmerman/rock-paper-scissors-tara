let e={ROCK:{id:"rock",beats:["scissors"],isStandard:!0,text:"Rock",icon:"ðŸª¨"},PAPER:{id:"paper",beats:["rock"],isStandard:!0,text:"Paper",icon:"ðŸ“„"},SCISSORS:{id:"scissors",beats:["paper"],isStandard:!0,text:"Scissors",icon:"âœ‚ï¸"},TARA:{id:"tara",beats:["rock","paper","scissors"],isStandard:!1,text:"Tara",icon:"â­"}},t=Object.values(e),s=Object.fromEntries(Object.entries(e).map(([e,t])=>[e,t.id])),a=t.map(e=>({name:e.id,beats:e.beats})),o=t.map(e=>e.id),r=new Map(a.map(e=>[e.name,e])),i=a.filter((e,s)=>t[s].isStandard),n=i.map(e=>e.name);i.map(e=>[e.name,e]);let l=t.map(e=>({id:e.id,text:e.text,icon:e.icon})),m="player",h="computer",u=[0,50,100,null],c={matchRoundNumber:1,playerHealth:100,computerHealth:100},g={player:"playerHealth",computer:"computerHealth"},d="Score",M="TaraCount",p="MostCommonMove",v="MoveCounts",C="roundNumber",S="globalMatchNumber",b="currentMatch",y={[s.ROCK]:0,[s.PAPER]:0,[s.SCISSORS]:0};class _{formatKey(e,t){return`${e}${t}`}safelySetItem(e,t){try{localStorage.setItem(e,t)}catch(t){console.warn(`LocalStorage Error: Failed to save "${e}".`,t)}}getScore(e){let t=this.formatKey(e,d);return parseInt(localStorage.getItem(t)||"0",10)}getTaraCount(e){let t=this.formatKey(e,M);return parseInt(localStorage.getItem(t)||"0",10)}getMostCommonMove(e){let t=this.formatKey(e,p),s=localStorage.getItem(t);return s&&n.includes(s)?s:null}getMoveCounts(e){let t=this.formatKey(e,v);try{let e=localStorage.getItem(t);return e?JSON.parse(e):y}catch(e){return console.warn(`LocalStorage Error: Failed to parse "${t}".`,e),y}}getGlobalMatchNumber(){let e=localStorage.getItem(S);return null!==e?parseInt(e,10):null}getMatch(){try{let e=localStorage.getItem(b);return e?JSON.parse(e):null}catch(e){return console.warn("LocalStorage Error: Failed to parse currentMatch.",e),null}}getOldGlobalRoundNumber(){let e=localStorage.getItem(C);if(null===e)return null;let t=parseInt(e,10);return isNaN(t)?(console.warn(`Legacy 'roundNumber' in localStorage (${e}) is not a valid number. Skipping migration.`),null):t}setScore(e,t){let s=this.formatKey(e,d);this.safelySetItem(s,t.toString())}setTaraCount(e,t){let s=this.formatKey(e,M);this.safelySetItem(s,t.toString())}setMostCommonMove(e,t){let s=this.formatKey(e,p);t?this.safelySetItem(s,t):localStorage.removeItem(s)}setMoveCounts(e,t){let s=this.formatKey(e,v);this.safelySetItem(s,JSON.stringify(t))}setGlobalMatchNumber(e){e?this.safelySetItem(S,e.toString()):localStorage.removeItem(S)}setMatch(e){e?this.safelySetItem(b,JSON.stringify(e)):localStorage.removeItem(b)}removeScore(e){let t=this.formatKey(e,d);localStorage.removeItem(t)}removeTaraCount(e){let t=this.formatKey(e,M);localStorage.removeItem(t)}removeMostCommonMove(e){let t=this.formatKey(e,p);localStorage.removeItem(t)}removeMoveCounts(e){let t=this.formatKey(e,v);localStorage.removeItem(t)}removeHistory(e){let t=this.formatKey(e,"History");localStorage.removeItem(t)}removeGlobalMatchNumber(){localStorage.removeItem(S)}removeOldGlobalRoundNumber(){localStorage.removeItem(C)}}class V{state={scores:{player:0,computer:0},moves:{player:null,computer:null},taras:{player:0,computer:0},mostCommonMove:{player:null,computer:null},moveCounts:{player:{rock:0,paper:0,scissors:0},computer:{rock:0,paper:0,scissors:0}},globalMatchNumber:null,currentMatch:null};gameStorage;constructor(e=new _){this.gameStorage=e,this.state.scores.player=this.gameStorage.getScore(m),this.state.scores.computer=this.gameStorage.getScore(h),this.state.taras.player=this.gameStorage.getTaraCount(m),this.state.taras.computer=this.gameStorage.getTaraCount(h),this.state.mostCommonMove.player=this.gameStorage.getMostCommonMove(m),this.state.mostCommonMove.computer=this.gameStorage.getMostCommonMove(h),this.state.moveCounts.player=this.gameStorage.getMoveCounts(m),this.state.moveCounts.computer=this.gameStorage.getMoveCounts(h),this._loadOrMigrateMatchState()}doesMoveBeat(e,t){return r.get(e)?.beats.includes(t)??!1}handleRoundWin(e,t){if(this.isStandardMove(t)){let t=this.getTaraCount(e);t<3&&this.setTaraCount(e,t+1)}}evaluateRound(){let e=this.getPlayerMove(),t=this.getComputerMove();return null===e||null===t?"Invalid round":(this.handleTaraMove(m,e),this.handleTaraMove(h,t),e===t)?"It's a tie!":this.doesMoveBeat(e,t)?(this.handleRoundWin(m,e),this.decrementHealth(h),"You win the round!"):(this.handleRoundWin(h,t),this.decrementHealth(m),"Computer wins the round!")}isMatchActive(){return null!==this.gameStorage.getMatch()}setScore(e,t){this.state.scores[e]=t,this.gameStorage.setScore(e,t)}getScore(e){return this.state.scores[e]}resetScore(e){this.state.scores[e]=0,this.gameStorage.removeScore(e)}setPlayerScore(e){this.setScore(m,e)}setComputerScore(e){this.setScore(h,e)}getPlayerScore(){return this.getScore(m)}getComputerScore(){return this.getScore(h)}resetScores(){this.resetScore(m),this.resetScore(h)}isStandardMove(e){return"string"==typeof e&&e!==s.TARA}setMove(e,t){this.state.moves[e]=t}getMove(e){return this.state.moves[e]}determineMostCommonMove(e){let t=null,s=0,a=!1;for(let[o,r]of Object.entries(e))r>s?(s=r,t=o,a=!1):r===s&&0!==r&&(a=!0);return a?null:t}resetMostCommonMove(e){this.state.mostCommonMove[e]=null,this.gameStorage.removeMostCommonMove(e)}setMostCommonMove(e,t){let s=this.determineMostCommonMove(t);this.state.mostCommonMove[e]=s,this.gameStorage.setMostCommonMove(e,s)}getMostCommonMove(e){return this.state.mostCommonMove[e]}getAvailableMoves(e){return e?o:n}getBaseWeights(){return{[s.ROCK]:1,[s.PAPER]:1,[s.SCISSORS]:1,[s.TARA]:0}}getTaraWeight(e){if(!e.includes(s.TARA))return null;let{player:t,computer:a}=this.state.scores,o=t-a;return o>0?Math.min(3+o,10):o<0?1:2}getStandardMoveWeights(){let e={[s.ROCK]:1,[s.PAPER]:1,[s.SCISSORS]:1},t=this.state.mostCommonMove.player;if(!t)return e;let a={[s.ROCK]:s.PAPER,[s.PAPER]:s.SCISSORS,[s.SCISSORS]:s.ROCK}[t];return{[s.ROCK]:a===s.ROCK?5:2,[s.PAPER]:a===s.PAPER?5:2,[s.SCISSORS]:a===s.SCISSORS?5:2}}chooseWeightedRandomMove(e,t){let s=e.flatMap(e=>Array(t[e]).fill(e)),a=Math.floor(Math.random()*s.length);return s[a]}getComputerMoveWeights(e){let t=this.getBaseWeights(),a=this.getTaraWeight(e),o=this.getStandardMoveWeights();return{...t,...o,...null!==a?{[s.TARA]:a}:{}}}getWeightedComputerMove(){let e=this.getComputerTaraCount()>0,t=this.getAvailableMoves(e),s=this.getComputerMoveWeights(t);return this.chooseWeightedRandomMove(t,s)}setPlayerMove(e){this.setMove(m,e)}getPlayerMove(){return this.getMove(m)}setComputerMove(e){this.setMove(h,e)}getComputerMove(){return this.getMove(h)}resetMoves(){this.setPlayerMove(null),this.setComputerMove(null)}chooseComputerMove(){let e=this.getWeightedComputerMove();this.registerComputerMove(e)}registerPlayerMove(e){this.setPlayerMove(e),this.isStandardMove(e)&&(this.setMoveCounts(m,e),this.setPlayerMostCommonMove())}registerComputerMove(e){this.setComputerMove(e),this.isStandardMove(e)&&(this.setMoveCounts(h,e),this.setComputerMostCommonMove())}setPlayerMostCommonMove(){let e=this.getMoveCounts(m);this.setMostCommonMove(m,e)}setComputerMostCommonMove(){let e=this.getMoveCounts(h);this.setMostCommonMove(h,e)}resetMostCommonMoves(){this.resetMostCommonMove(m),this.resetMostCommonMove(h)}getPlayerMostCommonMove(){return this.getMostCommonMove(m)}getComputerMostCommonMove(){return this.getMostCommonMove(h)}setMoveCounts(e,t){this.state.moveCounts[e][t]=(this.state.moveCounts[e][t]||0)+1,this.gameStorage.setMoveCounts(e,this.state.moveCounts[e])}resetMoveCounts(e){this.state.moveCounts[e]={rock:0,paper:0,scissors:0},this.gameStorage.removeMoveCounts(e)}getMoveCounts(e){return this.state.moveCounts[e]}resetBothMoveCounts(){this.resetMoveCounts(m),this.resetMoveCounts(h)}showMostCommonMove(){return null!==this.getPlayerMostCommonMove()||null!==this.getComputerMostCommonMove()}resetHistory(e){this.gameStorage.removeHistory(e)}resetHistories(){this.resetHistory(m),this.resetHistory(h)}getRoundNumber(){return this.state.currentMatch?.matchRoundNumber??1}setRoundNumber(e){this.state.currentMatch&&(this.state.currentMatch.matchRoundNumber=e,this.gameStorage.setMatch(this.state.currentMatch))}increaseRoundNumber(){let e=this.getRoundNumber();this.setRoundNumber(e+1)}decrementTaraCount(e){let t=this.getTaraCount(e);t>1?this.setTaraCount(e,t-1):1===t&&this.resetTaraCount(e)}handleTaraMove(e,t){t===s.TARA&&(this.getTaraCount(e)>0?this.decrementTaraCount(e):this.setMove(e,s.ROCK))}setTaraCount(e,t){this.state.taras[e]=t,this.gameStorage.setTaraCount(e,t)}getTaraCount(e){return this.state.taras[e]}resetTaraCount(e){this.state.taras[e]=0,this.gameStorage.removeTaraCount(e)}setPlayerTaraCount(e){this.setTaraCount(m,e)}setComputerTaraCount(e){this.setTaraCount(h,e)}resetTaras(){this.resetTaraCount(m),this.resetTaraCount(h)}getPlayerTaraCount(){return this.getTaraCount(m)}getComputerTaraCount(){return this.getTaraCount(h)}taraIsEnabled(){return this.getTaraCount(m)>0}handleMatchWin(){let e=this.getMatchWinner();return this.setScore(e,this.getScore(e)+1),e}setMatch(e){this.state.currentMatch=e,this.gameStorage.setMatch(e)}setMatchNumber(e){this.state.globalMatchNumber=e,this.gameStorage.setGlobalMatchNumber(e)}setDefaultMatchData(){this.isMatchActive()||this.setMatch({...c})}resetMatchData(){this.state.currentMatch=null,this.gameStorage.setMatch(null),this.setMatchNumber(null)}getMatchNumber(){return this.state.globalMatchNumber??1}isMatchOver(){return this.isDefeated(m)||this.isDefeated(h)}getMatchWinner(){return this.isDefeated(m)?h:m}incrementMatchNumber(){let e=this.getMatchNumber();this.setMatchNumber(e+1)}_loadOrMigrateMatchState(){if(this.isMatchActive())return void this._loadExistingMatchState();let e=this.gameStorage.getOldGlobalRoundNumber();null!==e&&e>0&&this._migrateOldData(e)}_loadExistingMatchState(){this.state.globalMatchNumber=this.gameStorage.getGlobalMatchNumber(),this.state.currentMatch=this.gameStorage.getMatch()}_migrateOldData(e){this.setMatch({matchRoundNumber:e,playerHealth:100,computerHealth:100,initialHealth:100,damagePerLoss:50}),this.gameStorage.removeOldGlobalRoundNumber(),this.state.globalMatchNumber=1,this.gameStorage.setGlobalMatchNumber(this.state.globalMatchNumber)}getHealthKey(e){return g[e]}getHealth(e){let t=this.state.currentMatch;if(!t)return null;let s=t[this.getHealthKey(e)];return u.includes(s)?s:null}decrementHealth(e){let t=this.state.currentMatch;if(!t)return!1;let s=this.getHealthKey(e),a=t[s];return!(a<=0)&&(t[s]=Math.max(0,a-50),!0)}isDefeated(e){let t=this.getHealth(e);return null!==t&&t<=0}}class E{_data;_parentElement;render(e){if(!e)return;this._data=e;let t=this._generateMarkup();this._clear(),this._parentElement.insertAdjacentHTML("afterbegin",t)}update(e){this._data=e;let t=this._generateMarkup(),s=Array.from(document.createRange().createContextualFragment(t).querySelectorAll("*")),a=Array.from(this._parentElement.querySelectorAll("*"));s.forEach((e,t)=>{let s=a[t];e.isEqualNode(s)||e.firstChild?.nodeValue?.trim()===""||e.firstChild?.nodeValue?.trim()===void 0||(s.textContent=e.textContent),e.isEqualNode(s)||(Array.from(e.attributes).forEach(e=>s.setAttribute(e.name,e.value)),Array.from(s.attributes).forEach(t=>{e.hasAttribute(t.name)||s.removeAttribute(t.name)}))})}_clear(){this._parentElement.innerHTML=""}_getElement(e){let t=document.getElementById(e);if(!t)throw Error(`Element #${e} not found.`);return t}_toggleVisibility(e,t){e.classList.toggle("hidden",!t)}}var w=new class extends E{_startBtn;_resetBtn;_generateMarkup(){let e=this._data.isMatchActive?"Continue Match":"Start Match";return`
      <div class="menu-content">
        <h1 id="game-title" class="title-large">Rock Paper Scissors Tara</h1>
        <div class="menu-controls">
          <button id="start" class="btn-primary">${e}</button>
          <button id="reset-game-state" class="btn-secondary">Reset Game State</button>
        </div>
      </div>
    `}_ensureParentElement(){this._parentElement&&document.body.contains(this._parentElement)||(this._parentElement=this._getElement("main-menu"))}render(e){this._ensureParentElement(),super.render(e),this._startBtn=this._getElement("start"),this._resetBtn=this._getElement("reset-game-state")}bindStartMatch(e){this._startBtn?.addEventListener("click",t=>{t.preventDefault(),e()})}bindResetGame(e){this._resetBtn?.addEventListener("click",t=>{t.preventDefault(),e()})}toggleMenuVisibility(e){this._ensureParentElement(),this._toggleVisibility(this._parentElement,e)}updateMenu(e){this._data={...this._data,...e},this.update(this._data),this._startBtn=this._getElement("start"),this._resetBtn=this._getElement("reset-game-state")}},R=new class extends E{_moveHandler;_generateMarkup(){let{moves:e,taraIsEnabled:t}=this._data;return e.map(e=>{let a=e.id===s.TARA&&!t;return`
        <button id="${e.id}" class="card-container" ${a?"disabled":""}>
          <span class="icon" aria-hidden="true">${e.icon}</span>
          <span class="label">${e.text}</span>
        </button>
      `}).join("")}toggleMoveButtons(e){this._parentElement||(this._parentElement=this._getElement("choices")),this._toggleVisibility(this._parentElement,e)}render(e){this._parentElement=this._getElement("choices"),super.render(e),this._setupListeners()}bindPlayerMove(e){this._moveHandler=e}updateTaraButton(e){this._data={...this._data,taraIsEnabled:e},this.update(this._data)}_setupListeners(){this._parentElement.onclick=e=>{let t=e.target.closest(".card-container");t&&this._moveHandler&&this._moveHandler(t.id)}}};class T extends E{_parentElement=document.getElementById("move-reveal");_generateMarkup(){let{playerMoveId:e,computerMoveId:t}=this._data,s=l.find(t=>t.id===e),a=l.find(e=>e.id===t);return s&&a?`
    <div class="card-container" disabled>
      <span class="icon">${s.icon}</span>
      <span class="label">${s.text}</span>
    </div>

    <span class="vs-label">VS</span>

    <div class="card-container" disabled>
      <span class="icon">${a.icon}</span>
      <span class="label">${a.text}</span>
    </div>
  `:""}toggleVisibility(e){this._toggleVisibility(this._parentElement,e)}}var N=new T,f=new class extends E{_generateMarkup(){let{playerMove:e,computerMove:t,resultMessage:s,isMatchOver:a}=this._data;return`
      <p id="round-moves">You played ${e}. Computer played ${t}.</p>
      <h2 id="round-result">${s}</h2>
      <button id="play-again">${a?"Start New Match":"Next Round"}</button>
    `}render(e){this._parentElement=this._getElement("result-display"),this.toggleOutcomeVisibility(!1),super.render(e)}bindPlayAgain(e){this._parentElement||(this._parentElement=this._getElement("result-display")),this._parentElement.addEventListener("click",t=>{t.target.closest("#play-again")&&e()})}toggleOutcomeVisibility(e){this._toggleVisibility(this._parentElement,e)}updateOutcome(e){this._data={...this._data,...e},this.update(this._data)}},P=new class extends E{_ensureParentElement(){this._parentElement&&document.body.contains(this._parentElement)||(this._parentElement=this._getElement("game-progress-container"))}_generateMarkup(){return`
      <h2 id="match">Match ${this._data.matchNumber}</h1>
      <h1 id="round">Round ${this._data.roundNumber}</h2>
    `}render(e){this._ensureParentElement(),super.render(e),this._toggleVisibility(this._parentElement,e.isVisible)}update(e){this._ensureParentElement(),super.update(e),this._toggleVisibility(this._parentElement,e.isVisible)}},I=new class extends E{get _computerHealthBarElement(){return this._getElement("computer-health")}get _computerHealthElement(){return this._getElement("computer-health-text")}get _computerMostCommonMoveElement(){return this._getElement("computer-most-common-move")}get _computerScoreElement(){return this._getElement("computer-score")}get _computerTaraCountElement(){return this._getElement("computer-tara")}get _playerHealthBarElement(){return this._getElement("player-health")}get _playerHealthElement(){return this._getElement("player-health-text")}get _playerMostCommonMoveElement(){return this._getElement("player-most-common-move")}get _playerScoreElement(){return this._getElement("player-score")}get _playerTaraCountElement(){return this._getElement("player-tara")}_generateMarkup(){return""}toggleGameStatsVisibility(e){this._parentElement=this._getElement("game-stats"),this._toggleVisibility(this._parentElement,e)}updateHealthBar(e,t){this._getHealthBar(e).style.width=`${t}%`}_getHealthBar(e){return"player"===e?this._playerHealthBarElement:this._computerHealthBarElement}updateMostCommonMoves(e,t){this._playerMostCommonMoveElement.textContent=e??"N/A",this._computerMostCommonMoveElement.textContent=t??"N/A"}updateScores(e,t){this._playerScoreElement.textContent=e.toString().padStart(2,"0"),this._computerScoreElement.textContent=t.toString().padStart(2,"0")}updateTaraCounts(e,t){this._playerTaraCountElement.textContent=e.toString(),this._computerTaraCountElement.textContent=t.toString()}};class A{model;menuView;moveView;moveRevealView;outcomeView;progressView;statsView;constructor(e,t){this.model=e,this.menuView=t.menuView,this.moveView=t.moveView,this.moveRevealView=t.moveRevealView,this.outcomeView=t.outcomeView,this.progressView=t.progressView,this.statsView=t.statsView}updateProgressView(e){this.progressView.update({matchNumber:this.model.getMatchNumber(),roundNumber:this.model.getRoundNumber(),isVisible:e.isVisible})}updateScoreView(){this.statsView.updateScores(this.model.getPlayerScore(),this.model.getComputerScore())}updateTaraView(){this.statsView.updateTaraCounts(this.model.getPlayerTaraCount(),this.model.getComputerTaraCount())}updateMostCommonMoveView(){this.statsView.updateMostCommonMoves(this.model.getPlayerMostCommonMove(),this.model.getComputerMostCommonMove())}updateHealthView(){let e=this.model.getHealth(m),t=this.model.getHealth(h);this.statsView.updateHealthBar(m,e),this.statsView.updateHealthBar(h,t)}updateTaraButtonView(){this.moveView.updateTaraButton(this.model.taraIsEnabled())}startGame(){this.model.setDefaultMatchData(),this.updateProgressView({isVisible:!0}),this.menuView.toggleMenuVisibility(!1),this.statsView.toggleGameStatsVisibility(!0),this.moveView.toggleMoveButtons(!0),this.updateHealthView()}endRound(){let e=this.model.getPlayerMove(),t=this.model.getComputerMove(),s=this.model.evaluateRound(),a=this.model.isMatchOver();this.updateHealthView();let o=s.toUpperCase();if(a){let e=this.model.handleMatchWin();o=`${e.toUpperCase()} WON THE MATCH!`,this.model.incrementMatchNumber(),this.model.setMatch(null)}else this.model.increaseRoundNumber();this.outcomeView.updateOutcome({playerMove:e,computerMove:t,resultMessage:o,isMatchOver:a}),this.outcomeView.toggleOutcomeVisibility(!0),this.updateScoreView(),this.updateTaraView(),this.updateMostCommonMoveView(),this.updateTaraButtonView()}handleNextRound(){this.model.setDefaultMatchData(),this.updateHealthView(),this.updateProgressView({isVisible:!0}),this.moveRevealView.toggleVisibility(!1),this.outcomeView.toggleOutcomeVisibility(!1),this.moveView.toggleMoveButtons(!0),this.statsView.toggleGameStatsVisibility(!0)}async resetGameState(){this.model.resetScores(),this.model.resetMoves(),this.model.resetTaras(),this.model.resetHistories(),this.model.resetBothMoveCounts(),this.model.resetMostCommonMoves(),this.model.resetMatchData();let e=this.model.isMatchActive();this.updateScoreView(),this.updateTaraView(),this.updateHealthView(),this.updateMostCommonMoveView(),this.updateTaraButtonView(),this.moveRevealView.toggleVisibility(!1),this.outcomeView.toggleOutcomeVisibility(!1),this.menuView.updateMenu({isMatchActive:e})}async handlePlayerMove(e){this.moveView.toggleMoveButtons(!1),this.model.resetMoves(),this.model.registerPlayerMove(e),this.model.chooseComputerMove(),this.moveRevealView.render({playerMoveId:this.model.getPlayerMove(),computerMoveId:this.model.getComputerMove()}),this.moveRevealView.toggleVisibility(!0),this.endRound()}async initialize(){let e=this.model.isMatchActive();this.menuView.render({isMatchActive:e}),this.progressView.render({matchNumber:this.model.getMatchNumber(),roundNumber:this.model.getRoundNumber(),isVisible:!1}),this.moveView.render({moves:l,taraIsEnabled:this.model.taraIsEnabled()}),this.outcomeView.render({playerMove:null,computerMove:null,resultMessage:"",isMatchOver:!1,roundNumber:this.model.getRoundNumber(),matchNumber:this.model.getMatchNumber()}),this.updateScoreView(),this.updateTaraView(),this.updateMostCommonMoveView(),this.menuView.updateMenu({isMatchActive:e}),this.statsView.toggleGameStatsVisibility(!1),this.moveView.toggleMoveButtons(!1),this.menuView.toggleMenuVisibility(!0),this.menuView.bindStartMatch(()=>this.startGame()),this.outcomeView.bindPlayAgain(()=>this.handleNextRound()),this.menuView.bindResetGame(()=>this.resetGameState()),this.moveView.bindPlayerMove(e=>this.handlePlayerMove(e)),this.updateTaraButtonView()}}document.addEventListener("DOMContentLoaded",()=>{new A(new V,{menuView:w,moveView:R,moveRevealView:N,outcomeView:f,progressView:P,statsView:I}).initialize()});
//# sourceMappingURL=public.01f3aade.js.map
